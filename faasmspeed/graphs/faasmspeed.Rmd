---
title: "Faasm latency measurements"
author: "Jakub Szewczyk"
date: "08-09-2021"
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
library(tidyverse)
library(rio)
library(scales)
knitr::opts_chunk$set(echo = FALSE)
```

```{r read_csv, include=FALSE, cache=TRUE, cache.extra = file.info("table.csv")}
raw_csv <- import('table.csv')
```

```{r tidy_bench}
t_data <- raw_csv %>%
  mutate (
    opts_host = factor(opts_host),
    opts_user = factor(opts_user),
    opts_function = factor(opts_function),
  )

```

## Latencies

```{r plot_lat_hello}
ggplot(t_data %>% filter(opts_function == "hello"),
    aes(x = opts_req_rps, ymin = latency_us_q1pct, ymax = latency_us_q99pct, lower = latency_us_q1, middle = latency_us_med, upper = latency_us_q3)) +
  geom_boxplot(stat = 'identity', aes(group = interaction(opts_req_rps, opts_function), color = opts_function)) +
  scale_x_continuous(trans = 'log', breaks = log_breaks(n=10), label = scales::label_comma(accuracy = 1)) +
  scale_y_continuous(trans = 'log', breaks = log_breaks(n=10), label = scales::label_comma(accuracy = 1)) +
  labs(title = "Latency for a given request per second rate") +
  xlab("Req/s") + ylab("Âµs")
```

```{r plot_lat_no_hello}
plot_scale <- 1.0/1000.0
ggplot(t_data %>% filter(opts_function != "hello"),
    aes(x = opts_req_rps, ymin = latency_us_q1pct*plot_scale, ymax = latency_us_q99pct*plot_scale, lower = latency_us_q1*plot_scale, middle = latency_us_med*plot_scale, upper = latency_us_q3*plot_scale)) +
  geom_boxplot(stat = 'identity', aes(group = interaction(opts_req_rps, opts_function), color = opts_function)) +
  scale_x_continuous(trans = 'log', breaks = log_breaks(n=20), label = scales::label_comma(accuracy = 1)) +
  scale_y_continuous(trans = 'log', breaks = log_breaks(n=20), label = scales::label_comma(accuracy = 1)) +
  labs(title = "Latency for a given request per second rate") +
  xlab("Req/s") + ylab("milliseconds")
```
